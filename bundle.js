/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	__webpack_require__(1);
	module.exports = __webpack_require__(5);


/***/ },
/* 1 */
/***/ function(module, exports, __webpack_require__) {

	"use strict";var Player=__webpack_require__(2),player=new Player,subsInput=document.querySelector(".popup__subs-input"),applyButton=document.querySelector(".popup__apply-button"),videoInput=document.querySelector(".popup__movie-input"),audioInput=document.querySelector(".popup__audio-input");applyButton.addEventListener("click",function(){player.videoMain.src=videoInput.value,player.audioElement.src=audioInput.value,fetch(subsInput.value).then(function(e){return e.text()}).then(function(e){player.subtitles=e,document.querySelector(".popup").style.visibility="hidden"})});

/***/ },
/* 2 */
/***/ function(module, exports, __webpack_require__) {

	"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),makeGrayScale=__webpack_require__(3),parse=__webpack_require__(4),Player=function(){function t(){_classCallCheck(this,t),this.block=document.querySelector(".player"),this.canvas=document.querySelector(".player__canvas"),this.webglCanvas=document.querySelector(".player__webgl-canvas"),this.videoMain=document.querySelector(".video-main"),this.videoEffect=document.querySelector(".video-effect"),this.timeLine=document.querySelector(".controls__time-line"),this.timeLineProgress=document.querySelector(".time-line__progress"),this.controls=document.querySelector(".player__controls"),this.playButton=document.querySelector(".controls__play-button"),this.audioElement=document.querySelector(".video-soundtrack"),this.loadingIcon=document.querySelector(".player__loading-icon"),this.sources=document.querySelector(".player__sources"),this.playButton.addEventListener("click",this.onPlayButtonToggle.bind(this)),this.timeLine.addEventListener("click",this.onTimeLineClick.bind(this)),this.timer=0,this.status={eventType:"video",play:!1},this.subs=[],this.subsFullDuration=0,this.canvasContext=this.canvas.getContext("2d"),this.videoMain.muted=!0,this.initSound(),this.dataLoaded={videoMain:!1,videoEffect:!1,videoSoundtrack:!1},this.sources.addEventListener("canplay",this.checkSourcesLoaded.bind(this),!0),this.sources.addEventListener("waiting",this.waitLoading.bind(this),!0)}return _createClass(t,[{key:"waitLoading",value:function(t){this.wasWaiting=!0,this.dataLoaded[t.target.dataset.type]=!1,this.controls.style.transform="translateY(100px)",this.loadingIcon.style.visibility="visible",this.status.play&&this.onPlayButtonToggle()}},{key:"checkSourcesLoaded",value:function(t){this.dataLoaded[t.target.dataset.type]=!0,this.dataLoaded.videoEffect&&this.dataLoaded.videoMain&&this.dataLoaded.videoSoundtrack&&(this.wasWaiting&&!this.status.play&&this.onPlayButtonToggle(),this.initCanvas(),this.controls.style.transform="translateY(0px)",this.loadingIcon.style.visibility="hidden")}},{key:"initCanvas",value:function(){if(!this.canvasInited){this.canvasInited=!0;var t=this.videoMain.videoWidth,e=this.videoMain.videoHeight;this.canvas.width=t,this.canvas.height=e,this.webglCanvas.width=t,this.webglCanvas.height=e,this.block.style.width="900px",this.block.style.height=e/t*900+"px",this.mainLoop()}}},{key:"mainLoop",value:function(){this.updateTime(),this.updateCurrentEvent(),this.status.play&&this.renderFrame(),requestAnimationFrame(this.mainLoop.bind(this))}},{key:"renderFrame",value:function(){"video"===this.status.eventType?(this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasContext.drawImage(this.videoMain,0,0,this.canvas.width,this.canvas.height)):this.showSubs(),makeGrayScale(),this.canvasContext.drawImage(this.webglCanvas,0,0,this.canvas.width,this.canvas.height),this.imposeOldEffect()}},{key:"updateTime",value:function(){if(this.status.play){var t=new Date;this.timer+=(t-this.timeStart)/1e3,this.timeStart=t}this.timeLineProgress.style.width=this.timer/(this.videoMain.duration+this.subsFullDuration)*100+"%"}},{key:"updateCurrentEvent",value:function(){var t=this.getEventByTime(this.timer);"video"===this.status.eventType&&"subs"===t.eventType&&this.videoMain.pause(),"subs"===this.status.eventType&&"video"===t.eventType&&this.status.play&&this.videoMain.play(),this.status=t}},{key:"getEventByTime",value:function(t){for(var e=0,i=this.subs,a=0;a<i.length;a++){var s=i[a];if(s.realStart<=t&&t<=s.realEnd)return{play:this.status.play,eventType:"subs",subIndex:a,videoTime:s.end};if(s.realStart>t)return{play:this.status.play,eventType:"video",videoTime:t-e};e+=s.duration}return{play:this.status.play,eventType:"video",videoTime:t-e}}},{key:"showSubs",value:function(){var t=this;this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.canvasContext.font="40px Oranienbaum",this.canvasContext.textAlign="center",this.canvasContext.fillStyle="white";var e=0;this.subs[this.status.subIndex].content.forEach(function(i){t.canvasContext.fillText(i,t.canvas.width/2,t.canvas.height/2+e),e+=45})}},{key:"imposeOldEffect",value:function(){this.canvasContext.globalAlpha=.5,this.canvasContext.drawImage(this.videoEffect,0,0,this.canvas.width,this.canvas.height),this.canvasContext.globalAlpha=1}},{key:"onPlayButtonToggle",value:function(){this.status.play?(this.pause(),this.playButton.classList.add("controls__play-button_used")):(this.play(),this.playButton.classList.remove("controls__play-button_used"))}},{key:"play",value:function(){this.updateTime(),this.timeStart=new Date,this.status.play=!0,this.noizeGain.connect(this.audioContext.destination),"video"===this.status.eventType&&this.videoMain.play(),this.videoEffect.play(),this.audioElement.play()}},{key:"pause",value:function(){this.updateTime(),this.status.play=!1,this.noizeGain.disconnect(),"video"===this.status.eventType&&this.videoMain.pause(),this.videoEffect.pause(),this.audioElement.pause()}},{key:"onTimeLineClick",value:function(t){var e=this.timeLine.getBoundingClientRect().left,i=this.timeLine.offsetWidth;this.timer=(t.clientX-e)/i*(this.videoMain.duration+this.subsFullDuration);var a=this.getEventByTime(this.timer);this.videoMain.currentTime=a.videoTime,this.updateCurrentEvent(),this.audioElement.currentTime=this.timer%this.audioElement.duration}},{key:"initSound",value:function(){this.audioContext=new AudioContext;var t=this.audioContext,e=t.destination,i=t.createMediaElementSource(this.audioElement),a=t.createBiquadFilter();a.type="highpass",a.frequency.value=900,a.gain.value=6,i.connect(a),a.connect(e);var s=4096,n=function(){var e,i,a,n,o,h,r;e=i=a=n=o=h=r=0;var u=t.createScriptProcessor(s,1,1);return u.onaudioprocess=function(t){for(var u=t.outputBuffer.getChannelData(0),l=0;s>l;l++){var c=2*Math.random()-1;e=.99886*e+.0555179*c,i=.99332*i+.0750759*c,a=.969*a+.153852*c,n=.8665*n+.3104856*c,o=.55*o+.5329522*c,h=-.7616*h-.016898*c,u[l]=e+i+a+n+o+h+r+.5362*c,u[l]*=.11,r=.115926*c}},u}();this.noizeGain=t.createGain(),n.connect(this.noizeGain),this.noizeGain.gain.value=.1}},{key:"subtitles",set:function(t){this.subs=parse(t);var e=0;this.subs.forEach(function(t,i){t.duration=t.end-t.start,t.realStart=t.end+e,t.realEnd=t.realStart+t.duration,e+=t.duration},this),this.subsFullDuration=e}}]),t}();module.exports=Player;

/***/ },
/* 3 */
/***/ function(module, exports) {

	"use strict";function postprocessWebGL(e,r,o){r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o),r.viewport(0,0,e.width,e.height),r.enable(r.DEPTH_TEST),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLES,0,6)}function prepareWebGL(e,r,o){var t=r.createProgram(),n="\n        attribute vec2 coordinates;\n        attribute vec2 texture_coordinates;\n        varying vec2 v_texcoord;\n        void main() {\n          gl_Position = vec4(coordinates,0.0, 1.0);\n          v_texcoord = texture_coordinates;\n        }\n        ",a=r.createShader(r.VERTEX_SHADER);r.shaderSource(a,n),r.compileShader(a);var l=" \n        precision mediump float;\n        varying vec2 v_texcoord;\n        uniform sampler2D u_texture;\n        uniform float u_time;\n        float grayScaleAt(vec2 point) {\n            return (0.3 * texture2D(u_texture, point).r) + (0.59 * texture2D(u_texture, point).g) + (0.11 * texture2D(u_texture, point).b);\n        }\n        float random(float x, float y, float color) {\n            return abs(fract(sin(dot(vec2(x + y, color + y) ,vec2(12.9898,78.233))) * 43758.5453));\n        }\n        void main() {\n            float x = v_texcoord.x;\n            float y = v_texcoord.y;\n            float color = grayScaleAt(v_texcoord);\n            float newColor = 0.0;\n            float prevRand = 0.0;\n\n            float R = 0.02;\n            for (int i = 0; i < 5; i++) {\n                float dx = (random(x, y, prevRand) - 0.5) * R;\n                float dy = (random(x, y, prevRand) - 0.5) * R;\n                newColor += grayScaleAt(vec2(x + dx, y + dy));\n                prevRand = dx * dy;\n            }\n            newColor = newColor / 5.0;\n            \n            // если полученный цвет сильно отличается от исходного, то он сглаживается\n\n            float maxDiff = 1.25;\n\n            if (newColor / color > maxDiff || color / newColor > maxDiff) {\n                newColor = (newColor + color) / 2.0;\n            }\n\n            float maxDiff2 = 1.5;\n\n            if (newColor / color > maxDiff2 || color / newColor > maxDiff2) {\n                newColor = (newColor + 2.0 * color) / 3.0;\n            }\n\n            float maxDiff3 = 2.0;\n            \n            if (newColor / color > maxDiff3 || color / newColor > maxDiff3) {\n                newColor = (newColor + 4.0 * color) / 5.0;\n            }\n\n            gl_FragColor = vec4(newColor, newColor, newColor, 1.0);\n        }\n        ",i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,l),r.compileShader(i),r.attachShader(t,a),r.attachShader(t,i),r.linkProgram(t),r.useProgram(t);var c=r.getAttribLocation(t,"coordinates"),f=r.getAttribLocation(t,"texture_coordinates"),x=r.createBuffer(),_=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];r.bindBuffer(r.ARRAY_BUFFER,x),r.bufferData(r.ARRAY_BUFFER,new Float32Array(_),r.STATIC_DRAW),r.enableVertexAttribArray(c),r.vertexAttribPointer(c,2,r.FLOAT,!1,0,0),x=r.createBuffer();var u=[0,1,1,1,0,0,0,0,1,1,1,0];r.bindBuffer(r.ARRAY_BUFFER,x),r.bufferData(r.ARRAY_BUFFER,new Float32Array(u),r.STATIC_DRAW),r.enableVertexAttribArray(f),r.vertexAttribPointer(f,2,r.FLOAT,!1,0,0);var R=r.createTexture();r.bindTexture(r.TEXTURE_2D,R),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)}function makeGrayScale(){postprocessWebGL(webglCanvas,webglContext,canvas)}function init(){webglCanvas=document.querySelector(".player__webgl-canvas"),canvas=document.querySelector(".player__canvas"),webglContext=webglCanvas.getContext("webgl")||webglCanvas.getContext("experimental-webgl"),null!==webglContext?prepareWebGL(webglCanvas,webglContext,canvas):(webglSupport=!1,alert("Похоже, что в данном браузере не поддерживается webgl :("))}var webglCanvas,canvas,webglContext,webglSupport=!0;init(),module.exports=makeGrayScale;

/***/ },
/* 4 */
/***/ function(module, exports) {

	"use strict";function decodeTimeMoment(e){var t=parseInt(e.substr(0,2)),r=parseInt(e.substr(3,2)),n=parseInt(e.substr(6,2)),s=parseInt(e.substr(9,3));return 3600*t+60*r+n+s/1e3}function decodeTimePeriod(e,t){var r=e.substr(0,12),n=e.substr(17,12);return{start:decodeTimeMoment(r),end:decodeTimeMoment(n)}}function Parse(e){for(var t=e.split("\n"),r=[],n=0;n<t.length;){var s=t[n];if(-1!==s.indexOf("-->")){var o=decodeTimePeriod(s),d={start:o.start,end:o.end,content:[]};for(n++;n!==t.length&&""!==t[n];)d.content.push(t[n]),n++;r.push(d)}n++}return r}module.exports=Parse;

/***/ },
/* 5 */
/***/ function(module, exports) {

	"use strict";!function(t){function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return y.iterable&&(e[Symbol.iterator]=function(){return e}),e}function n(t){this.map={},t instanceof n?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function s(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function i(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function a(t){var e=new FileReader;return e.readAsArrayBuffer(t),i(e)}function h(t){var e=new FileReader;return e.readAsText(t),i(e)}function u(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(y.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(y.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(t){if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob?(this.blob=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return h(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=s(this);return t?t:Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t){var e=t.toUpperCase();return b.indexOf(e)>-1?e:t}function d(t,e){e=e||{};var r=e.body;if(d.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new n(t.headers)),this.method=t.method,this.mode=t.mode,r||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new n(e.headers)),this.method=f(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(n))}}),e}function c(t){var e=new n,r=(t.getAllResponseHeaders()||"").trim().split("\n");return r.forEach(function(t){var r=t.trim().split(":"),o=r.shift().trim(),n=r.join(":").trim();e.append(o,n)}),e}function l(t,e){e||(e={}),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof n?e.headers:new n(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var y={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};n.prototype.append=function(t,o){t=e(t),o=r(o);var n=this.map[t];n||(n=[],this.map[t]=n),n.push(o)},n.prototype["delete"]=function(t){delete this.map[e(t)]},n.prototype.get=function(t){var r=this.map[e(t)];return r?r[0]:null},n.prototype.getAll=function(t){return this.map[e(t)]||[]},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(t,o){this.map[e(t)]=[r(o)]},n.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(o){t.call(e,o,r,this)},this)},this)},n.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),o(t)},n.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),o(t)},n.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),o(t)},y.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this)},u.call(d.prototype),u.call(l.prototype),l.prototype.clone=function(){return new l(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},l.error=function(){var t=new l(null,{status:0,statusText:""});return t.type="error",t};var m=[301,302,303,307,308];l.redirect=function(t,e){if(-1===m.indexOf(e))throw new RangeError("Invalid status code");return new l(null,{status:e,headers:{location:t}})},t.Headers=n,t.Request=d,t.Response=l,t.fetch=function(t,e){return new Promise(function(r,o){function n(){return"responseURL"in i?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):void 0}var s;s=d.prototype.isPrototypeOf(t)&&!e?t:new d(t,e);var i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,headers:c(i),url:n()},e="response"in i?i.response:i.responseText;r(new l(e,t))},i.onerror=function(){o(new TypeError("Network request failed"))},i.ontimeout=function(){o(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&y.blob&&(i.responseType="blob"),s.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send("undefined"==typeof s._bodyInit?null:s._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:void 0);

/***/ }
/******/ ]);